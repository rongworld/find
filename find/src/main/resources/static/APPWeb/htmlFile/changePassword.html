<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="viewport"  content="initial-scale=1"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link type="text/css" rel="stylesheet" href="../cssFile/login.css" />
<link type="text/css" rel="stylesheet" href="../cssFile/changePassword.css" />
<script type="text/javascript" src="../jsFile/login.js"></script>
<title>changePassword</title>
</head>

<body onload="setHtmlSize()">
<div class="div1">
	<button class="backIcon" onclick="window.location.href='login.html'"></button>
	<div id="GMMdiv1" class="gmmDiv1">
	    <table class="chPasswordTable">
	    <tr>
	        <td class="td1"></td>
	        <td><input type="text" id="numInCh" class="cinInput" placeholder="学号"/></td>   
	    </tr>
	    <tr><td colspan="2"><hr /></td></tr>
	    <tr><td colspan="2" class="hrHeight"></td></tr>
	    <tr>
	        <td class="td2"></td>
	        <td><input type="password" id="oldPassword" class="cinInput" placeholder="原密码" /></td>
	    </tr>
	    <tr><td colspan="2"><hr /></td></tr>
	    <tr><td colspan="2" class="hrHeight"></td></tr>
	    <div id="ErrorTip" class="newErrorStyle"></div>
	    <tr>
	        <td class="changeKeytd"></td>
	        <td><input type="password" id="newPassword" class="cinInput" placeholder="请输入新密码" /></td>
	    </tr>
	    <tr><td colspan="2"><hr /></td></tr>
	    
	    </table>
	    <table class="enterTable">
		<tr>
	    <td height="83" class="td3"><input type="button" id="loginInCh" value="确认修改" class="loginInpute" onclick="sendNewMessage()" /></td>
	    </tr>
	    </table>

	</div>
	<div id="GMMdiv2" class="gmmDiv2">
		<div class="pageFoot"></div>
	</div>
	<div id="footdiv" class="footDiv">
		<div class="footIcon"></div>
	</div>
</div>
</body>
<script>
function getNewMessage(NewMessage){
	var numID = document.getElementById("numInCh");
	var oldPasswordID = document.getElementById("oldPassword");
	var newPasswordID = document.getElementById("newPassword");
	NewMessage.username = numID.value;
	NewMessage.oldPassword = oldPasswordID.value;
	NewMessage.newPassword = newPasswordID.value;
	if(NewMessage.username ==""||NewMessage.username.length!=10||NewMessage.oldPassword ==""||NewMessage.newPassword ==""){
		document.getElementById("ErrorTip").style.display="block";
		document.getElementById("ErrorTip").innerHTML="学号或密码错误！";
		return false;
	}
	return true;
}
function sendMsg(Message,url){
	var jsonMessage =JSON.stringify(Message);
	var xhr= new XMLHttpRequest();
	xhr.onreadystatechange = function(){
		if(xhr.readyState == 4){
			if(xhr.status >= 200 && xhr.status < 300 || xhr.status == 304){
				var response = JSON.parse(xhr.responseText);
				if(response.code == 0){
					document.getElementById("ErrorTip").style.display="block";
					document.getElementById("ErrorTip").innerHTML="修改成功！";
				}
				else{
					document.getElementById("ErrorTip").style.display="block";
					document.getElementById("ErrorTip").innerHTML="修改失败！";
				}
				setTimeout("deleteTipMessage()",1500);
			}
			else{
				alert("网络错误:"+xhr.status);
			}
		}
	};
	xhr.open('post',url,true);
	xhr.send(jsonMessage);
}
function sendNewMessage(){
	var NewMessage = {
		username:"",
		oldPassword:"",
		newPassword:""
	};
	if(getNewMessage(NewMessage)){
		sendMsg(NewMessage,"http://localhost:8080/api/password");
	}
	else{
		setTimeout("deleteTipMessage()",1500);
	}
}
</script>
</html>
